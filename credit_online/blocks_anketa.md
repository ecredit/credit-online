# Логика работы Кредит Онлайн

## Полный список параметров
Имя параметра | Значение по умолчанию | Описание
--- | --- | ---
dealer_id | - | id дилера по нумерации еКредит для установки конекста
brand | - | марка автомобиля
model | - | Модель автомобиля
configuration | - | Комплектация
vin | - | VIN номер автомобиля
car_condition | 1 | 1 - новый автомобиль, 2 - пробежный
price | - | стоимость автомобиля (обязательное поле для car_condition=2)
token | - | Публичный токен
initial_fee | 50 | Первоначальный взнос в процентах
initial_fee_money | 50 | Первоначальный взнос в рублях
anketa_type | 1 | 1 - короткая анкета, 2 - полная


## Конекст
Кредит Онлайн не требует обязательных параметров и настраивает контекст дефолтного дилера автоматически и сразу готова к работе. Но параметры работы страницы можно изменить, передав соответствующие параметры.

Страница всегда работает в контексте какого-то конкретного дилерского центра. Например, список автомобилей загружается именно для конкретного ДЦ, кредитные предложения выдаются именно по подключенным к данному ДЦ банкам и прочее.

По умолчанию берется так называемый "дефолтный дилерский центр" - это дилерский центр по умолчанию назначенный для сайта Кредит Онлайн у каждого партнера.

Но можно принудительно изменить контекст работы страницы Кредит Онлайн. Для этого в строке параметров необходимо указать dealer_id по нумерации еКредит. При этом данный dealer_id должен быть привязан к настройкам текущего сайта. Если передать невалидный параметр dealer_id, то он не будет учитываться и будет примен дефолтный контекст.

Так же контекст может быть настроен с помощью публичного токена.


## Блок меню F&I Hub
Блок представляет собой главное меню сайта, которое содержит ссылки на все подключенные к данному сайту сервисы. Отображение и состав данного блока настраивается в системе еКредит.


## Блок калькулятора
Блок калькулятора состоит из следующих элементов:
1. Селекты выбора автомобиля
1. Поле стоимости автомобиля, поле ввода первоначального взноса и слайдер первоначального взноса
1. Список кредитных расчетов

В селектах отображается набор автомобилей, который используется внутри системы еКредит для дилера из текущего контекста.

Список новых автомобилей в системе еКредит может задаваться или настройками Карфина, либо дилер может загружать свой собственный каталог автомобилей.

Набор пробежных автомобилей для всех дилеров внутри еКредита используется один и тот же.

### Входящие параметры для блока калькулятора

Параметры **brand, model, configuration** используются для определения в селектах автомобиля данных *Марка, Модель, Комплектация*.

Параметры *brand, model* всегда должны в точности соответствовать справочникам в еКредите.

Так же нужно учитывать, контекст работы страницы. Переданный автомобиль может быть распознан в селектах только в том случае, если он уже в них загружен. А за загруженный список автомобилей в селектах отвечает текущий контекст работы Кредит Онлайна.

То есть логика такова. Саначала страница инициализируется в соответствии с текущим установленным контекстом с учетом переданного параметра dealer_id, а уже после этого начинает "тюнинговаться" переданными параметрами

По умолчанию в контекст ставится дефолтный дилер, привязанный к вашей среде. И если в дефолтном дилере такого автомобиля нет, то необходимо установить контекст с нужным дилером, передав в параметрах запроса dealer_id по нумерации еКредит.

Комплектация автомобиля устанавливается параметром configuration. 

В случае новых автомобилей список комплектаций ограничен или настройками карфина, или списком самого дилера, который был предварительно загружен в еКредит.

В случае пробежных автомобилей, комплектации никак не заданы. Поэтому в селектах подставится то значение, которое вы передадите. Данное значение ограничено маской: должно состоять только из букв латинского алфавита, пробела, цифр и некоторых символов (скобки, запятая, дефис)

Если вы передаете информацию по пробежному автомобилю, то необходиму указать параметр **car_condition**=2. Любые другие значения данного параметра, как и его отстутствие, будут задавать логику работы для новых автомобилей.

Для получения списка кредитных расчетов необходимо учитывать, чтобы дилер из контекста мог работать с соответствующим типом автомобилей: новые или пробежные.

Например, каталог пробежных автомобилей для всех дилеров на стороне еКредит одинаков (заданы только марки и модели). И даже если дилерский центр не работает с пробежными автомобилями, то передав параметр car_condition=2 вы все равно увидите, что селекты наполнены списками пробежных автомобилей. Но получить список кредитных расчетов в этом случае не получится, так как для дилера не задана логика работы с пробежными автомобилями.

По умолчанию первоначальный взнос ставится в 50%. Это поле доступно для редактирования, но его можно предзаполнить передав параметр initial_fee_money (значение в рублях) или initial_fee (значение в процентах, например, 52). Если переданы оба параметра, то будет испольован параметр initial_fee

**Поиск автомобиля по VIN номеру**
Для новых автомобилей (car_condition=1 или не задан) для случая когда передан вин номер автомобиля, но одновременно не передано ни одно из полей *brand, model, configuratin*, будет выполнена попытка найти автомбиль в базе данных еКредита по vin номеру. В данном случае поиск будет проводиться внутри справочника автомобилей дилера, определенного в контексте запроса.

## Блок с анкетой клиента
Анкета может отображена полная или короткая. По умолчанию отображается та анкета, которая задана в настройках еКредита для данного контекста. Но, если для партнера включена такая возможность, то можно переключать анкеты входящим параметров anketa_type: 1 - короткая анкета, 2 - полная анкета.

## Блок выбора дилера
1. Отображаются дилеры, которые привязаны к дилерской группе данного текущего токена
1. Список дилеров становится доступен только после выбора кредитного расчета. В этот момент из всего доступного списка дилеров остаются только те, которые торгуют брендом, выбранного автомобиля

