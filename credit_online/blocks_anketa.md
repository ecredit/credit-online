# Логика работы Кредит Онлайн

## Конекст
Страница Кредит Онлайн всегда работает в контексте какого-то конкретного дилерского центра. Например, список автомобилей загружается именно для конкретного ДЦ, кредитные предложения выдаются именно по подключенным к данному ДЦ банкам и прочее.

По умолчанию берется так называемый "дефолтный дилерский центр" - это дилерский центр по умолчанию назначенный для сайта Кредит Онлайн у каждого партнера.

Но можно принудетльно изменить контекст работы страницы Кредит Онлайн. Для этого в строке параметров необходимо указать dealer_id по нумерации еКредит. При этом данный dealer_id должен быть привязан к настройкам текущего сайта.

## Блок меню F&I Hub
Блок представляет собой главное меню сайта, которое содержит ссылки на все подключенные к данному сайту сервисы.


## Блок калькулятора
Блок калькулятора состоит из следующих элементов:
1. Селекты выбора автомобиля
1. Поле стоимости автомобиля, поле ввода первоначального взноса и слайдер первоначального взноса
1. Список кредитных расчетов

В селектах отображается набор автомобилей, который используется внутри системы еКредит для дилера из текущего контекста.

Список новых автомобилей в системе еКредит может задаваться или настройками Карфина, либо дилер может загружать свой собственный каталог автомобилей.

Набор пробежных автомобилей для всех дилеров внутри еКредита используется один и тот же.

## Блок выбора дилера
1. Отображаются дилеры, которые привязаны к дилерской группе данного текущего токена
1. Список дилеров становится доступен только после выбора кредитного расчета. В этот момент из всего доступного списка дилеров остаются только те, которые торгуют брендом, выбранного автомобиля

## Входящие параметры
Кредит Онлайн не требует обязательных параметров. Страница партнера настраивает контекст дефолтного дилера автоматически и сразу готова к работе. Но параметры работы страницы можно изменить, передав соответствующие параметры.

Параметр **dealer_id** задает контекст работы Кредит Онлайна.

Параметры **brand, model, configuration** используются для определения в селектах автомобиля данных *Марка, Модель, Комплектация*.

Параметры *brand, model* всегда должны в точности соответствовать справочникам в еКредите.

Так же нужно учитывать, контекст работы страницы. Переданный автомобиль может быть распознан в селектах только в том случае, если он уже в них загружен. А за загруженный список автомобилей в селектах отвечает текущий контекст работы Кредит Онлайна.

То есть логика такова. Саначала страница инициализируется в соответствии с текущим установленным контекстом с учетом переданного параметра dealer_id, а уже после этого начинает "тюнинговаться" переданными параметрами

По умолчанию в контекст ставится дефолтный дилер, привязанный к вашей среде. И если в дефолтном дилере такого автомобиля нет, то необходимо установить контекст с нужным дилером, передав в параметрах запроса dealer_id по нумерации еКредит.

Комплектация автомобиля устанавливается параметром configuration. 

В случае новых автомобилей список комплектаций ограничен или настройками карфина, или списком самого дилера, который был предварительно загружен в еКредит.

В случае пробежных автомобилей, комплектации никак не заданы. Поэтому в селектах подставится то значение, которое вы передадите. Данное значение ограничено маской: должно состоять только из букв латинского алфавита, пробела, цифр и некоторых символов (скобки, запятая, дефис)

Если вы передаете информацию по пробежному автомобилю, то необходиму указать параметр **car_condition**=2. Любые другие значения данного параметра, как и его отстутствие, будут задавать логику работы для новых автомобилей.

Для получения списка кредитных расчетов необходимо учитывать, чтобы дилер из контекста мог работать с соответствующим типом автомобилей: новые или пробежные.

Например, каталог пробежных автомобилей для всех дилеров на стороне еКредит одинаков (заданы только марки и модели). И даже если дилерский центр не работает с пробежными автомобилями, то передав параметр car_condition=2 вы все равно увидите, что селекты наполнены списками пробежных автомобилей. Но получить список кредитных расчетов в этом случае не получится, так как для дилера не задана логика работы с пробежными автомобилями.

## Полный список параметров
Имя параметра | Значение по умолчанию | Описание
--- | --- | ---
dealer_id | - | id дилера по нумерации еКредит
brand | - | марка автомобиля
model | - | инфо
configuration | - | инфо
vin | - | инфо
car_condition | 1 | инфо
token | - | инфо
